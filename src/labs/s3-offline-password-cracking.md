!!! danger "Goals"
    1. Practice with offline password cracking tools (including hash collection tools)
    2. Collect and crack password hashes

!!! reminder "Methodology"
    **Local Password Cracking**

    1. Shutdown the target
    2. Boot on your alternate OS (change BIOS boot order)
    3. <div class="tooltip">Mount target<span class="tooltiptext"><b>How to mount a drive</b>:<ol><li>Find the right device: `ls /dev/sd*` (e.g. `/etc/sda1`)</li><li>Create the mount destination: `sudo mkdir /mnt/win_c`</li><li>Mount the partition: `sudo mount -t "ntfs" -o ro /dev/sda1 /mnt/win_c`</li></ol></span></div> 's drive
    4. Use password hash collection tools to extract the hashes
    5. Crack the collected hashes with a cracking tool

    **Remote Password Cracking**

    1. Gain a remote shell on the target (preferably a Meterpreter)
    2. Collect the password hashes (easy with a Meterpreter: `hashdump`)
    3. Crack the collected hashes with a cracking tool

**Reference**: [Engelbretson, p106]

!!! reminder "Words Dictionaries"
    In Kali, multiple dictionaries are available in folder `/usr/share/wordlists/` or John The Ripper also provides a dictionary file `/usr/share/john/password.lst`.

<details><summary>**Metasploitable2 - How to mount `/` when booting from Kali Linux**</summary><p>
~~~~{.console}
root@kali:/# mount /dev/sda5 /mnt/metasploitable/
mount: unknown filesystem type 'LVM2_member'
root@kali:/# vgscan
  Reading volume groups from cache.
  Found volume group "metasploitable" using metadata type lvm2
root@kali:/mnt# vgchange -ay metasploitable 
  2 logical volume(s) in volume group "metasploitable" now active
root@kali:/# ll /dev/metasploitable/
[...]
lrwxrwxrwx  1 root root    7 Sep  5 15:33 root -> ../dm-0
lrwxrwxrwx  1 root root    7 Sep  5 15:33 swap_1 -> ../dm-1
root@kali:/# mount /dev/metasploitable/root /mnt/metasploitable
~~~~
</p></details>


---

### Samdump2 and BkHive

**Reference**: [Engelbretson, p102]

**Command**: `samdump2 system SAM > /tmp/hashes.txt`

<details><summary>**Output**</summary><p>
~~~~{.console}
root@kali:~# cd /mnt/win_c/WINDOWS/system32/config
root@kali:~# ll
[...]
-rwxrwxrwx 1 root root 256K Sep  5  2017 SAM
[...]
-rwxrwxrwx 1 root root 2.8M Sep  5  2017 system
[...]
root@kali:~# samdump2 system SAM > /tmp/hashes.txt
root@kali:~# cat /tmp/hashes.txt
Administrator:500:f4e7a5e9eaa82e6c1104594f8c2ef12b:3c46a3eea50266895130f29113dac770:::
[...]
~~~~
</p></details>

**Command**: `bkhive system system_key.txt` and `samdump2 SAM system_key.txt > /tmp/hashes.txt`

<details><summary>**Output**</summary><p>
~~~~{.console}
root@kali:~# cd /mnt/winxp_c/WINDOWS/system32/config
root@kali:~# ll
[...]
-rwxrwxrwx 1 root root [...] SAM
[...]
-rwxrwxrwx 1 root root [...] system
[...]
root@kali:~# bkhive system /tmp/system_key.txt
root@kali:~# samdump2 SAM /tmp/system_key.txt > /tmp/hashes.txt
root@kali:~# cat /tmp/hashes.txt
Administrator:500:f4e7a5e9eaa82e6c1104594f8c2ef12b:3c46a3eea50266895130f29113dac770:::
[...]
~~~~
</p></details>

----

### Unshadow

**Reference**: [Engelbretson, p108]

**Command**: `unshadow /etc/passwd /etc/shadow > /tmp/hashes.txt`

<details><summary>**Output**</summary><p>
~~~~{.console}
root@kali:~# cd /mnt/metasploitable/etc/
root@kali:~# ll
[...]
-rwxrwxrwx 1 root root [...] passwd
[...]
-rwxrwxrwx 1 root root [...] shadow
[...]
root@kali:~# unshadow passwd shadow > /tmp/hashes.txt
root@kali:~# cat /tmp/hashes.txt
root:$1$/avpfBJ1$x0z8w5UF9Iv./DR9E9Lid.:0:0:root:/root:/bin/bash
daemon:*:1:1:daemon:/usr/sbin:/bin/sh
bin:*:2:2:bin:/bin:/bin/sh
sys:$1$fUX6BPOt$Miyc3UpOzQJqz4s5wFD9l0:3:3:sys:/dev:/bin/sh
sync:*:4:65534:sync:/bin:/bin/sync
[...]
~~~~
</p></details>

---

### John The Ripper

**Reference**: [Engelbretson, p97]

**Command**: `john /tmp/hashes.txt` (other usage examples available [here](http://www.openwall.com/john/doc/EXAMPLES.shtml))

- `--format=`: select a hash format (e.g. `nt` for NTLM)

<details><summary>**Output**</summary><p>
**Windows XP**

~~~~{.console}
root@kali:/# john /tmp/hashes.txt 
Created directory: /root/.john
Warning: detected hash type "LM", but the string is also recognized as "NT"
Use the "--format=NT" option to force loading these as that type instead
Warning: detected hash type "LM", but the string is also recognized as "NT-old"
Use the "--format=NT-old" option to force loading these as that type instead
Using default input encoding: UTF-8
Using default target encoding: CP850
Loaded 5 password hashes with no different salts (LM [DES 128/128 AVX-16])
Press 'q' or Ctrl-C to abort, almost any other key for status
F                (Administrator:2)
[...]
~~~~

**Metasploitable2**

~~~~{.console}
root@kali:/# john /tmp/hashes.txt 
Created directory: /root/.john
Warning: detected hash type "md5crypt", but the string is also recognized as "aix-smd5"
Use the "--format=aix-smd5" option to force loading these as that type instead
Using default input encoding: UTF-8
Loaded 7 password hashes with 7 different salts (md5crypt, crypt(3) $1$ [MD5 128/128 AVX 4x3])
Press 'q' or Ctrl-C to abort, almost any other key for status
postgres         (postgres)
user             (user)
msfadmin         (msfadmin)
service          (service)
123456789        (klog)
batman           (sys)
[...]
~~~~

</p></details>

---

!!! important "Findings"
    Multiple credentials (see before).
